<script>
    // Função para carregar dados do carrinho no resumo do pedido
    function carregarDadosCarrinho() {
        try {
            // 1. Obter subtotal da URL
            const urlParams = new URLSearchParams(window.location.search);
            const subtotal = urlParams.get('subtotal');
            
            // 2. Obter dados do localStorage
            const produtosJSON = localStorage.getItem('carrinho_produtos');
            const totalItens = localStorage.getItem('carrinho_total_itens');
            
            if (!produtosJSON) {
                console.log('Nenhum dado de carrinho encontrado');
                return;
            }
            
            const produtos = JSON.parse(produtosJSON);
            
            // 3. Atualizar subtotal no resumo
            if (subtotal) {
                const subtotalFormatado = parseFloat(subtotal).toLocaleString('pt-BR', {
                    style: 'currency',
                    currency: 'BRL'
                });
                
                // Atualizar sidebar
                const subtotalElement = document.querySelector('.order-totals .total-row span:nth-child(2)');
                if (subtotalElement) {
                    subtotalElement.textContent = subtotalFormatado;
                }
                
                // Atualizar mobile
                const mobileTotalPrice = document.getElementById('mobileTotalPrice');
                if (mobileTotalPrice) {
                    mobileTotalPrice.textContent = subtotalFormatado;
                }
            }
            
            // 4. Atualizar total final (será recalculado com frete)
            atualizarTotalFinal(subtotal);
            
            console.log('Dados do carrinho carregados com sucesso');
            console.log('Produtos:', produtos);
            console.log('Total de itens:', totalItens);
            
        } catch (error) {
            console.error('Erro ao carregar dados do carrinho:', error);
        }
    }
    
    // Função para atualizar o total final
    function atualizarTotalFinal(subtotal) {
        if (!subtotal) return;
        
        const subtotalNum = parseFloat(subtotal);
        let frete = 0;
        
        // Obter valor do frete selecionado
        const shippingOption = document.querySelector('.shipping-option.selected');
        if (shippingOption) {
            const priceText = shippingOption.querySelector('.shipping-price').textContent;
            if (priceText !== 'GRÁTIS') {
                frete = parseFloat(priceText.replace('R$ ', '').replace(',', '.'));
            }
        }
        
        const total = subtotalNum + frete;
        const totalFormatado = total.toLocaleString('pt-BR', {
            style: 'currency',
            currency: 'BRL'
        });
        
        // Atualizar sidebar
        const totalElement = document.querySelector('.order-totals .total-row.final span:nth-child(2)');
        if (totalElement) {
            totalElement.textContent = totalFormatado;
        }
        
        // Atualizar mobile
        const mobileFinalPrice = document.getElementById('mobileFinalPrice');
        if (mobileFinalPrice) {
            mobileFinalPrice.textContent = totalFormatado;
        }
    }
    
    // Carregar dados quando a página terminar de carregar
    document.addEventListener('DOMContentLoaded', carregarDadosCarrinho);
    
    // Recarregar totais quando mudar opção de frete
    document.querySelectorAll('.shipping-option').forEach(option => {
        option.addEventListener('click', function() {
            const subtotal = new URLSearchParams(window.location.search).get('subtotal');
            atualizarTotalFinal(subtotal);
        });
    });
</script>
